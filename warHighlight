/** @format */

// ==UserScript==
// @name         War Offline Okay Highlight
// @namespace    http://torn.city.com.dot.com.com
// @version      0.1
// @description  Gets offline enemies that are out of hospital
// @author       Ironhydedragon
// @match        https://www.torn.com/factions*
// @license      MIT
// ==/UserScript==

/*  This script is a work in progress
    Possible features: 
      - ignore players above (x) level
      - include [arrayOfPlayers]
      - exclude [arrayOfPlayers]
      - sorting function
*/

////////  VARIABLES  ////////
const green = '#85b200';
const greenTranslucent = 'rgba(133, 178, 0, 0.4)';
const greenLight = '#6cad2b';
const gray = 'rgb(34, 34, 34)';

////////  MODEL  ////////
function getEmemiesArr() {
  return [...document.querySelectorAll('li.enemy')];
}

////////  VIEW  ////////
function renderStyles(el, isValidTarget = false) {
  const attackContainerEl = el.querySelector('.attack');
  if (isValidTarget) {
    el.style.border = `1px solid ${green}`;
    attackContainerEl.style.background = greenTranslucent;
  } else {
    el.style.border = `1px solid ${gray}`;
    attackContainerEl.style.background = 'none';
  }
}

(function () {
  setInterval(() => {
    // get list of enemies
    const enemiesArr = getEmemiesArr();

    enemiesArr.forEach((el) => {
      const svgIconEl = el.querySelector('.userStatusWrap___ljSJG svg');
      const statusEl = el.querySelector('.status');

      const svgFillValue = svgIconEl.getAttribute('fill');
      const statusValue = statusEl.textContent;

      const isOffline =
        svgFillValue === 'url("#svg_status_offline")' ||
        svgFillValue === 'url("#svg_status_idle")';
      const isAttackable = statusValue === 'okay';

      const isValidTarget = isAttackable && isOffline;
      renderStyles(el, isValidTarget);

      renderStyles(el, isOffline);
    });
  }, 500);
})();
